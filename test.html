<!DOCTYPE HTML>
<html>
<head>
	<title></title>
	<style>
      .left {
        float: left;
       
        height: 300px;
        background-color: red;
      }
      .right {
        height: 300px;
      }
    </style>
</head>
<body>
	<div id="result">
		<span id="timeDiv">戊戌(朱雀) 甲寅(申破)(玄武) 癸巳(腾蛇) 丁巳(勾陈) (午未空) </span>
		<div>
		人元 1<span id="renyuanDiv">甲子 海中金 青龙</span>
		</br>
		地元 1<span id="shiyuanDiv">丙子 海中金 白虎</span>
		</div>
		
		<div>
			<div class="left">
				<span id="shiergong1div">123</br>123123</span>
			</div>
			<div class="right">
				<span id="shiergong2div">456</span>
			</div>
		</div>
		
	</div>	
	
    <div>
        <span id="lblYear">年</span>
        <select name="ddYear" id="ddYear">
			<option value="2000">2000</option>
			<option value="2001">2001</option>
			<option value="2002">2002</option>
			<option value="2003">2003</option>
			<option value="2004">2004</option>
			<option value="2005">2005</option>
			<option value="2006">2006</option>
			<option value="2007">2007</option>
			<option value="2008">2008</option>
			<option value="2009">2009</option>
			<option value="2010">2010</option>
			<option value="2011">2011</option>
			<option value="2012">2012</option>
			<option value="2013">2013</option>
			<option value="2014">2014</option>
			<option value="2015">2015</option>
			<option value="2016">2016</option>
			<option value="2017">2017</option>
			<option value="2018">2018</option>
			<option value="2019">2019</option>
			<option value="2020">2020</option>

		</select>
        
        <span id="lblMonth">月</span>
		 <select name="ddMonth" id="ddMonth">
			<option value="1">1</option>
			<option selected="selected" value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5</option>
			<option value="6">6</option>
			<option value="7">7</option>
			<option value="8">8</option>
			<option value="9">9</option>
			<option value="10">10</option>
			<option value="11">11</option>
			<option value="12">12</option>
		</select>
        
        <span id="lblDay">日</span>
		   <select name="ddDay" id="ddDay">
			<option value="1">1</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5</option>
			<option value="6">6</option>
			<option value="7">7</option>
			<option value="8">8</option>
			<option value="9">9</option>
			<option value="10">10</option>
			<option value="11">11</option>
			<option value="12">12</option>
			<option value="13">13</option>
			<option value="14">14</option>
			<option value="15">15</option>
			<option value="16">16</option>
			<option value="17">17</option>
			<option value="18">18</option>
			<option value="19">19</option>
			<option value="20">20</option>
			<option value="21">21</option>
			<option value="22">22</option>
			<option value="23">23</option>
			<option value="24">24</option>
			<option value="25">25</option>
			<option value="26">26</option>
			<option value="27">27</option>
			<option value="28">28</option>
			<option value="29">29</option>
			<option value="30">30</option>
			<option value="31">31</option>

		</select>
        
        <span id="lblHour">时</span>
        <select name="ddHour" id="ddHour">
			<option value="1">1</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5</option>
			<option value="6">6</option>
			<option value="7">7</option>
			<option value="8">8</option>
			<option value="9">9</option>
			<option value="10">10</option>
			<option value="11">11</option>
			<option value="12">12</option>
			<option value="13">13</option>
			<option value="14">14</option>
			<option value="15">15</option>
			<option value="16">16</option>
			<option value="17">17</option>
			<option value="18">18</option>
			<option value="19">19</option>
			<option value="20">20</option>
			<option value="21">21</option>
			<option value="22">22</option>
			<option value="23">23</option>
		</select>
		
		</br>
		    <span id="lblTianWei">人元</span>
        <select name="ddRenYuan" id="ddRenYuan">
			<option selected="selected" value="1">1</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5</option>
			<option value="6">6</option>
			<option value="7">7</option>
			<option value="8">8</option>
			<option value="9">9</option>
			<option value="0">0</option>
		</select>
        
        </br>
        
        <span id="lblRenWei">事元</span>
        <select name="ddShiYuan" id="ddShiYuan">
			<option selected="selected" value="1">1</option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5</option>
			<option value="6">6</option>
			<option value="7">7</option>
			<option value="8">8</option>
			<option value="9">9</option>
			<option value="0">0</option>
	  </select>
        </br>
		 <input type="button" name="btnCal" value="计算" id="btnCal" onclick="calLunar()"/>
     </div>   
        



<script type="text/javascript">

function calLunar(){
	//获取年月日时 人元 地元
	var  myselect=document.getElementById("ddYear");
	var index=myselect.selectedIndex ;            
	var year=myselect.options[index].value;
	
	var  myselect=document.getElementById("ddMonth");
	var index=myselect.selectedIndex ;            
	var month=myselect.options[index].value;
	
	
	var  myselect=document.getElementById("ddDay");
	var index=myselect.selectedIndex ;            
	var day=myselect.options[index].value;
	
	var  myselect=document.getElementById("ddHour");
	var index=myselect.selectedIndex ;            
	var hour=myselect.options[index].value;
	
	var  myselect=document.getElementById("ddRenYuan");
	var index=myselect.selectedIndex ;            
	var renYuan=myselect.options[index].value;
	
	var  myselect=document.getElementById("ddShiYuan");
	var index=myselect.selectedIndex ;            
	var shiYuan=myselect.options[index].value;
	
	//将年月日转成干支
	var YMDHGanZhiObj=getSolarLunar(year,month,day,hour);
	//根据日干 计算六神
	var riGan=YMDHGanZhiObj.gzDay.split("")[0];
	var liuShen=calLunarLiuShen(riGan);
	//根据日干 计算出人元、事元的 干支
	var renshiYuanGanZhi=calLunarGanZhi(riGan,renYuan,shiYuan);
		
	//这里支可能会存在两个
	if(renshiYuanGanZhi.renyuan.zhi.split("").length>1){
		var dizhi1=renshiYuanGanZhi.renyuan.zhi.split("")[0];
		var dizhi2=renshiYuanGanZhi.renyuan.zhi.split("")[1];
		
		//根据干支获取纳音
		var naYin=getNaYinByGanZhi(renshiYuanGanZhi.renyuan.gan+""+dizhi1);
		//根据人元纳音、人元的干、日干获取12宫
		var shierGong=getShiErGong(naYin,renshiYuanGanZhi.renyuan.gan,riGan)
		
		//根据干支获取纳音
		var naYin=getNaYinByGanZhi(renshiYuanGanZhi.renyuan.gan+""+dizhi2);
		//根据人元纳音、人元的干、日干获取12宫
		var shierGong=getShiErGong(naYin,renshiYuanGanZhi.renyuan.gan,riGan)
		
	}else{
		//根据干支获取纳音
		var naYin=getNaYinByGanZhi(renshiYuanGanZhi.renyuan.gan+""+renshiYuanGanZhi.renyuan.zhi);
		//根据人元纳音、人元的干、日干获取12宫
		var shierGong=getShiErGong(naYin,renshiYuanGanZhi.renyuan.gan,riGan)
	}

	
		debugger;
}

/**
按照人元 排12宫
naYin:人元纳音
renYuanGan:人元干
riGan:日干

**/
//纳音  根据人元的干(判断顺逆)
function getShiErGong(naYin,renYuanGan,riGan){
	//12宫名称数组
	var shiErGongArr=["命宫","兄弟宫","婚姻宫","子息宫","财帛宫","疾病宫","迁移宫","奴仆宫","官禄宫","田宅宫","福德宫","父母宫"];
	//地支顺行
	var diZhiShun=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥","子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"];
	//地支逆行
	var diZhiNi=["亥", "戌", "酉", "申", "未", "午", "巳", "辰", "卯", "寅", "丑", "子","亥", "戌", "酉", "申", "未", "午", "巳", "辰", "卯", "寅", "丑", "子"];
	
	//获取纳音最后一位。根据最后一位判断 水木金火土
	var wuXing=naYin.charAt(naYin.length-1);
	
	//判断人元地支 阴阳判断是顺逆
	var flag=false;//默认是逆
	var tianGanYangObj={
		"甲":"甲",
		"丙":"丙",
		"戊":"戊",
		"庚":"庚",
		"壬":"壬"
	};
	//如果有则是顺
	if(tianGanYangObj[renYuanGan]) flag=true;
	
	//五行 阴阳对应的地支起始
	var wuXingObjToDiZhi={
		"水":{
			yin:"卯",
			yang:"申"
		},
		"木":{
			yin:"午",
			yang:"亥"
		},
		"火":{
			yin:"酉",
			yang:"寅"
		},
		"土":{
			yin:"亥",
			yang:"午"
		},
		"金":{
			yin:"丑",
			yang:"辰"
		},
	};
	
	//获取命宫地支  (获取地支五行  水木金火土的阴阳)
	var mingGongDiZhi = wuXingObjToDiZhi[wuXing].yin;
	//如果是阳，则取阳支
	if(flag) mingGongDiZhi = wuXingObjToDiZhi[wuXing].yang;
	
	//获取12宫对应的地址
	var diZhiArr=[];
	if(flag){//顺行
		var tmpFlag=0;
		for(var i=0;i<diZhiShun.length;i++){
			if(diZhiShun[i]==mingGongDiZhi){
				tmpFlag=i;
				break;
			}
		}
		for(var j=tmpFlag;j<tmpFlag+12;j++){
			diZhiArr.push(diZhiShun[j]);
		}
		
	}else{//逆行
		var tmpFlag=0;
		for(var i=0;i<diZhiNi.length;i++){
			if(diZhiNi[i]==mingGongDiZhi){
				tmpFlag=i;
				break;
			}
		}
		for(var j=tmpFlag;j<tmpFlag+12;j++){
			diZhiArr.push(diZhiNi[j]);
		}
	}
	
	
	
	//根据日干 遁出支的干
	var tmpArr;
	if(riGan=='甲'||riGan=='己'){
		//甲子
		tmpArr=["甲子","乙丑","丙寅","丁卯","戊辰","己巳","庚午","辛未","壬申","癸酉","甲戌","乙亥"];
	}else if(riGan=='乙'||riGan=='庚'){
		//丙子
		tmpArr=["丙子","丁丑","戊寅","己卯","庚辰","辛巳","壬午","癸未","甲申","乙酉","丙戌","丁亥"];
	}else if(riGan=='丙'||riGan=='辛'){
		//戊子
		tmpArr=["戊子","己丑","庚寅","辛卯","壬辰","癸巳","甲午","乙未","丙申","丁酉","戊戌","己亥"];
	}else if(riGan=='丁'||riGan=='壬'){
		//庚子
		tmpArr=["庚子","辛丑","壬寅","癸卯","甲辰","乙巳","丙午","丁未","戊申","己酉","庚戌","辛亥"];
	}else if(riGan=='戊'||riGan=='癸'){
		//壬子
		tmpArr=["壬子","癸丑","甲寅","乙卯","丙辰","丁巳","戊午","己未","庚申","辛酉","壬戌","癸亥"];
	}
	
	var retArr=[];
	
	
	
		
	for(var i=0;i<diZhiArr.length;i++){
		for(var j=0;j<tmpArr.length;j++){
			if(tmpArr[j].indexOf(diZhiArr[i])!=-1){//找到了对应的干
				var nayin=getNaYinByGanZhi(tmpArr[j]);
				var obj={
					name:shiErGongArr[i],
					nayin:nayin,
					ganzhi:tmpArr[j]
				};
				retArr.push(obj);
				break;
			}
		}	
	}

	
	console.log(retArr);
	
	return retArr;
	
	
}

/**
根据干支 获取纳音
**/
function getNaYinByGanZhi(ganZhi){
	var NaYinObj={
		"甲子":"海中金",
		"乙丑":"海中金",
		"丙寅":"炉中火",
		"丁卯":"炉中火",
		"戊辰":"大林木",
		"己巳":"大林木",
		"庚午":"路旁土",
		"辛未":"路旁土",
		"壬申":"剑锋金",
		"癸酉":"剑锋金",
		
		"甲戌":"山头火",
		"乙亥":"山头火",
		"丙子":"涧下水",
		"丁丑":"涧下水",
		"戊寅":"城头土",
		"己卯":"城头土",
		"庚辰":"白蜡金",
		"辛巳":"白蜡金",
		"壬午":"杨柳木",
		"癸未":"杨柳木",
		
		"甲申":"井泉水",
		"乙酉":"井泉水",
		"丙戌":"屋上土",
		"丁亥":"屋上土",
		"戊子":"霹雳火",
		"己丑":"霹雳火",
		"庚寅":"松柏木",
		"辛卯":"松柏木",
		"壬辰":"长流水",
		"癸巳":"长流水",
		
		"甲午":"砂中金",
		"乙未":"砂中金",
		"丙申":"山下火",
		"丁酉":"山下火",
		"戊戌":"平地木",
		"己亥":"平地木",
		"庚子":"壁上土",
		"辛丑":"壁上土",
		"壬寅":"金箔金",
		"癸卯":"金箔金",
		
		"甲辰":"覆灯火",
		"乙巳":"覆灯火",
		"丙午":"天河水",
		"丁未":"天河水",
		"戊申":"大驿土",
		"己酉":"大驿土",
		"庚戌":"钗钏金",
		"辛亥":"钗钏金",
		"壬子":"桑柘木",
		"癸丑":"桑柘木",
		
		"甲寅":"大溪水",
		"乙卯":"大溪水",
		"丙辰":"砂中土",
		"丁巳":"砂中土",
		"戊午":"天上火",
		"己未":"天上火",
		"庚申":"石榴木",
		"辛酉":"石榴木",
		"壬戌":"大海水",
		"癸亥":"大海水",
	};
	
	return NaYinObj[ganZhi];
}


/**
根据日干 计算六神
**/
function calLunarLiuShen(riGan,renYuan,shiYuan){
	var liuShen=["青龙","朱雀","勾陈","腾蛇","白虎","玄武"];
	
	var yangGan=["甲","丙","戊","庚","壬"];
	var yinGan=["乙","丁","己","辛","癸"];
	
	//默认逆
	var flag=false;
	//阳顺阴逆
	for(var i=0;i<yangGan.length;i++){
		if(yangGan[i]==riGan){
			flag=true;
			break;
		}
	}
	
	var retObj={
		hour:liuShen[5],
		renyun:liuShen[4],
		shiYuan:liuShen[3],
		year:liuShen[2],
		month:liuShen[1],
		day:liuShen[0]
	};
	if(flag){
		retObj={
			day:liuShen[0],
			hour:liuShen[1],
			renyun:liuShen[2],
			shiYuan:liuShen[3],
			year:liuShen[4],
			month:liuShen[5]
		};
	}
		
	return retObj;
}


/**
根据日干 计算出人元、事元的 干支
**/
function calLunarGanZhi(riGan,renYuan,shiYuan){
	//将人元\事元 转成干  河图
	//0-9
	var renshiYuan=["己","壬","丁","甲","辛","戊","癸","丙","乙","庚"];
	//将人元、事元 数字转成干
	var renYuanGan=renshiYuan[renYuan*1];
	var shiYuanGan=renshiYuan[shiYuan*1];
	
	//从干上的第几个起。
	var flag=0;
	if(riGan=='甲'||riGan=='己'){
		flag=0;//甲子戌
	}else if(riGan=='乙'||riGan=='庚'){
		flag=2;//丙子戌
	}else if(riGan=='丙'||riGan=='辛'){
		flag=4;//戊子戌
	}else if(riGan=='丁'||riGan=='壬'){
		flag=6;//庚子戌
	}else if(riGan=='戊'||riGan=='癸'){
		flag=8;//壬子戌
	}
	
	//["子戌","丑亥","寅","卯","辰","巳","午","未","申","酉",]
	//比如日干是庚。人元是1，事元是2. 那么1=壬、2=丁
	//庚日从丙，即丙子戌、丁丑亥、戊寅。。。。乙酉
	//则为 壬午、丁丑亥
	
	//日干是甲、乙
	//甲子戌、乙丑亥、丙寅、丁卯、戊辰、己巳、庚午、辛未、壬申、癸酉
	
	//日干戊、癸
	//壬子戌、癸丑亥、甲寅、乙卯、丙辰、丁巳、戊午、己未、庚申、辛酉、
	
	var tmpObj={
		"甲":0,
		"乙":1,
		"丙":2,
		"丁":3,
		"戊":4,
		"己":5,
		"庚":6,
		"辛":7,
		"壬":8,
		"癸":9
	};
	
	var dizhiArr=["子戌","丑亥","寅","卯","辰","巳","午","未","申","酉","子戌","丑亥","寅","卯","辰","巳","午","未","申","酉"];
	
	//这里会存在数小于flag的情况
	var shiYuanShu=tmpObj[shiYuanGan];
	if(shiYuanShu<flag) shiYuanShu=shiYuanShu+10;
	var renYuanShu=tmpObj[renYuanGan];
	if(renYuanShu<flag) renYuanShu=renYuanShu+10;
	
	var renyuanDizhi=dizhiArr[renYuanShu-flag];
	var shiyuanDiZhi=dizhiArr[shiYuanShu-flag];
	
	return {
		renyuan:{
			zhi:renyuanDizhi,
			gan:renYuanGan
		},
		shiYuan:{
			zhi:shiyuanDiZhi,
			gan:shiYuanGan
		}
	};
}


function initTime(){
		var myDate = new Date();//获取系统当前时间
		var fullYear=myDate.getFullYear();
		var month=myDate.getMonth()+1+"";
		var day=myDate.getDate();
		var hour=myDate.getHours();
		
		
		     
		
		var ddYearArr = document.getElementById("ddYear").options;  
		for(var i=0;i<ddYearArr.length;i++){
			if(fullYear==ddYearArr[i].value){
					ddYearArr[i].selected = true;  
					break;  
			}
		}
		
		ddYearArr = document.getElementById("ddMonth").options;  
		for(var i=0;i<ddYearArr.length;i++){
			if(month==ddYearArr[i].value){
					ddYearArr[i].selected = true;  
					break;  
			}
		}
		
		ddYearArr = document.getElementById("ddDay").options;  
		for(var i=0;i<ddYearArr.length;i++){
			if(day==ddYearArr[i].value){
					ddYearArr[i].selected = true;  
					break;  
			}
		}
		
		ddYearArr = document.getElementById("ddHour").options;  
		for(var i=0;i<ddYearArr.length;i++){
			if(hour==ddYearArr[i].value){
					ddYearArr[i].selected = true;  
					break;  
			}
		}
		
		
}
initTime();

/**
* @1900-2100区间内的公历、农历互转
* @charset UTF-8
* @Author  Jea杨(JJonline@JJonline.Cn) 
* @Time    2014-7-21
* @Time    2016-8-13 Fixed 2033hex、Attribution Annals
* @Time    2016-9-25 Fixed lunar LeapMonth Param Bug
* @Time    2017-7-24 Fixed use getTerm Func Param Error.use solar year,NOT lunar year
* @Version 1.0.3
* @公历转农历：calendar.solar2lunar(1987,11,01); //[you can ignore params of prefix 0]
* @农历转公历：calendar.lunar2solar(1987,09,10); //[you can ignore params of prefix 0]
*/
var calendar = {

    /**
      * 农历1900-2100的润大小信息表
      * @Array Of Property
      * @return Hex 
      */
    lunarInfo:[0x04bd8,0x04ae0,0x0a570,0x054d5,0x0d260,0x0d950,0x16554,0x056a0,0x09ad0,0x055d2,//1900-1909
            0x04ae0,0x0a5b6,0x0a4d0,0x0d250,0x1d255,0x0b540,0x0d6a0,0x0ada2,0x095b0,0x14977,//1910-1919
            0x04970,0x0a4b0,0x0b4b5,0x06a50,0x06d40,0x1ab54,0x02b60,0x09570,0x052f2,0x04970,//1920-1929
            0x06566,0x0d4a0,0x0ea50,0x06e95,0x05ad0,0x02b60,0x186e3,0x092e0,0x1c8d7,0x0c950,//1930-1939
            0x0d4a0,0x1d8a6,0x0b550,0x056a0,0x1a5b4,0x025d0,0x092d0,0x0d2b2,0x0a950,0x0b557,//1940-1949
            0x06ca0,0x0b550,0x15355,0x04da0,0x0a5b0,0x14573,0x052b0,0x0a9a8,0x0e950,0x06aa0,//1950-1959
            0x0aea6,0x0ab50,0x04b60,0x0aae4,0x0a570,0x05260,0x0f263,0x0d950,0x05b57,0x056a0,//1960-1969
            0x096d0,0x04dd5,0x04ad0,0x0a4d0,0x0d4d4,0x0d250,0x0d558,0x0b540,0x0b6a0,0x195a6,//1970-1979
            0x095b0,0x049b0,0x0a974,0x0a4b0,0x0b27a,0x06a50,0x06d40,0x0af46,0x0ab60,0x09570,//1980-1989
            0x04af5,0x04970,0x064b0,0x074a3,0x0ea50,0x06b58,0x055c0,0x0ab60,0x096d5,0x092e0,//1990-1999
            0x0c960,0x0d954,0x0d4a0,0x0da50,0x07552,0x056a0,0x0abb7,0x025d0,0x092d0,0x0cab5,//2000-2009
            0x0a950,0x0b4a0,0x0baa4,0x0ad50,0x055d9,0x04ba0,0x0a5b0,0x15176,0x052b0,0x0a930,//2010-2019
            0x07954,0x06aa0,0x0ad50,0x05b52,0x04b60,0x0a6e6,0x0a4e0,0x0d260,0x0ea65,0x0d530,//2020-2029
            0x05aa0,0x076a3,0x096d0,0x04afb,0x04ad0,0x0a4d0,0x1d0b6,0x0d250,0x0d520,0x0dd45,//2030-2039
            0x0b5a0,0x056d0,0x055b2,0x049b0,0x0a577,0x0a4b0,0x0aa50,0x1b255,0x06d20,0x0ada0,//2040-2049
            /**Add By JJonline@JJonline.Cn**/
            0x14b63,0x09370,0x049f8,0x04970,0x064b0,0x168a6,0x0ea50, 0x06b20,0x1a6c4,0x0aae0,//2050-2059
            0x0a2e0,0x0d2e3,0x0c960,0x0d557,0x0d4a0,0x0da50,0x05d55,0x056a0,0x0a6d0,0x055d4,//2060-2069
            0x052d0,0x0a9b8,0x0a950,0x0b4a0,0x0b6a6,0x0ad50,0x055a0,0x0aba4,0x0a5b0,0x052b0,//2070-2079
            0x0b273,0x06930,0x07337,0x06aa0,0x0ad50,0x14b55,0x04b60,0x0a570,0x054e4,0x0d160,//2080-2089
            0x0e968,0x0d520,0x0daa0,0x16aa6,0x056d0,0x04ae0,0x0a9d4,0x0a2d0,0x0d150,0x0f252,//2090-2099
            0x0d520],//2100

    /**
      * 公历每个月份的天数普通表
      * @Array Of Property
      * @return Number 
      */
    solarMonth:[31,28,31,30,31,30,31,31,30,31,30,31],

    /**
      * 天干地支之天干速查表
      * @Array Of Property trans["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"]
      * @return Cn string 
      */
    Gan:["\u7532","\u4e59","\u4e19","\u4e01","\u620a","\u5df1","\u5e9a","\u8f9b","\u58ec","\u7678"],

    /**
      * 天干地支之地支速查表
      * @Array Of Property 
      * @trans["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"]
      * @return Cn string 
      */
    Zhi:["\u5b50","\u4e11","\u5bc5","\u536f","\u8fb0","\u5df3","\u5348","\u672a","\u7533","\u9149","\u620c","\u4ea5"],

    /**
      * 天干地支之地支速查表<=>生肖
      * @Array Of Property 
      * @trans["鼠","牛","虎","兔","龙","蛇","马","羊","猴","鸡","狗","猪"]
      * @return Cn string 
      */
    Animals:["\u9f20","\u725b","\u864e","\u5154","\u9f99","\u86c7","\u9a6c","\u7f8a","\u7334","\u9e21","\u72d7","\u732a"],

    /**
      * 24节气速查表
      * @Array Of Property 
      * @trans["小寒","大寒","立春","雨水","惊蛰","春分","清明","谷雨","立夏","小满","芒种","夏至","小暑","大暑","立秋","处暑","白露","秋分","寒露","霜降","立冬","小雪","大雪","冬至"]
      * @return Cn string 
      */
    solarTerm:["\u5c0f\u5bd2","\u5927\u5bd2","\u7acb\u6625","\u96e8\u6c34","\u60ca\u86f0","\u6625\u5206","\u6e05\u660e","\u8c37\u96e8","\u7acb\u590f","\u5c0f\u6ee1","\u8292\u79cd","\u590f\u81f3","\u5c0f\u6691","\u5927\u6691","\u7acb\u79cb","\u5904\u6691","\u767d\u9732","\u79cb\u5206","\u5bd2\u9732","\u971c\u964d","\u7acb\u51ac","\u5c0f\u96ea","\u5927\u96ea","\u51ac\u81f3"],

    /**
      * 1900-2100各年的24节气日期速查表
      * @Array Of Property 
      * @return 0x string For splice
      */
    sTermInfo:['9778397bd097c36b0b6fc9274c91aa','97b6b97bd19801ec9210c965cc920e','97bcf97c3598082c95f8c965cc920f',
              '97bd0b06bdb0722c965ce1cfcc920f','b027097bd097c36b0b6fc9274c91aa','97b6b97bd19801ec9210c965cc920e',
              '97bcf97c359801ec95f8c965cc920f','97bd0b06bdb0722c965ce1cfcc920f','b027097bd097c36b0b6fc9274c91aa',
              '97b6b97bd19801ec9210c965cc920e','97bcf97c359801ec95f8c965cc920f','97bd0b06bdb0722c965ce1cfcc920f',
              'b027097bd097c36b0b6fc9274c91aa','9778397bd19801ec9210c965cc920e','97b6b97bd19801ec95f8c965cc920f',
              '97bd09801d98082c95f8e1cfcc920f','97bd097bd097c36b0b6fc9210c8dc2','9778397bd197c36c9210c9274c91aa',
              '97b6b97bd19801ec95f8c965cc920e','97bd09801d98082c95f8e1cfcc920f','97bd097bd097c36b0b6fc9210c8dc2',
              '9778397bd097c36c9210c9274c91aa','97b6b97bd19801ec95f8c965cc920e','97bcf97c3598082c95f8e1cfcc920f',
              '97bd097bd097c36b0b6fc9210c8dc2','9778397bd097c36c9210c9274c91aa','97b6b97bd19801ec9210c965cc920e',
              '97bcf97c3598082c95f8c965cc920f','97bd097bd097c35b0b6fc920fb0722','9778397bd097c36b0b6fc9274c91aa',
              '97b6b97bd19801ec9210c965cc920e','97bcf97c3598082c95f8c965cc920f','97bd097bd097c35b0b6fc920fb0722',
              '9778397bd097c36b0b6fc9274c91aa','97b6b97bd19801ec9210c965cc920e','97bcf97c359801ec95f8c965cc920f',
              '97bd097bd097c35b0b6fc920fb0722','9778397bd097c36b0b6fc9274c91aa','97b6b97bd19801ec9210c965cc920e',
              '97bcf97c359801ec95f8c965cc920f','97bd097bd097c35b0b6fc920fb0722','9778397bd097c36b0b6fc9274c91aa',
              '97b6b97bd19801ec9210c965cc920e','97bcf97c359801ec95f8c965cc920f','97bd097bd07f595b0b6fc920fb0722',
              '9778397bd097c36b0b6fc9210c8dc2','9778397bd19801ec9210c9274c920e','97b6b97bd19801ec95f8c965cc920f',
              '97bd07f5307f595b0b0bc920fb0722','7f0e397bd097c36b0b6fc9210c8dc2','9778397bd097c36c9210c9274c920e',
              '97b6b97bd19801ec95f8c965cc920f','97bd07f5307f595b0b0bc920fb0722','7f0e397bd097c36b0b6fc9210c8dc2',
              '9778397bd097c36c9210c9274c91aa','97b6b97bd19801ec9210c965cc920e','97bd07f1487f595b0b0bc920fb0722',
              '7f0e397bd097c36b0b6fc9210c8dc2','9778397bd097c36b0b6fc9274c91aa','97b6b97bd19801ec9210c965cc920e',
              '97bcf7f1487f595b0b0bb0b6fb0722','7f0e397bd097c35b0b6fc920fb0722','9778397bd097c36b0b6fc9274c91aa',
              '97b6b97bd19801ec9210c965cc920e','97bcf7f1487f595b0b0bb0b6fb0722','7f0e397bd097c35b0b6fc920fb0722',
              '9778397bd097c36b0b6fc9274c91aa','97b6b97bd19801ec9210c965cc920e','97bcf7f1487f531b0b0bb0b6fb0722',
              '7f0e397bd097c35b0b6fc920fb0722','9778397bd097c36b0b6fc9274c91aa','97b6b97bd19801ec9210c965cc920e',
              '97bcf7f1487f531b0b0bb0b6fb0722','7f0e397bd07f595b0b6fc920fb0722','9778397bd097c36b0b6fc9274c91aa',
              '97b6b97bd19801ec9210c9274c920e','97bcf7f0e47f531b0b0bb0b6fb0722','7f0e397bd07f595b0b0bc920fb0722',
              '9778397bd097c36b0b6fc9210c91aa','97b6b97bd197c36c9210c9274c920e','97bcf7f0e47f531b0b0bb0b6fb0722',
              '7f0e397bd07f595b0b0bc920fb0722','9778397bd097c36b0b6fc9210c8dc2','9778397bd097c36c9210c9274c920e',
              '97b6b7f0e47f531b0723b0b6fb0722','7f0e37f5307f595b0b0bc920fb0722','7f0e397bd097c36b0b6fc9210c8dc2',
              '9778397bd097c36b0b70c9274c91aa','97b6b7f0e47f531b0723b0b6fb0721','7f0e37f1487f595b0b0bb0b6fb0722',
              '7f0e397bd097c35b0b6fc9210c8dc2','9778397bd097c36b0b6fc9274c91aa','97b6b7f0e47f531b0723b0b6fb0721',
              '7f0e27f1487f595b0b0bb0b6fb0722','7f0e397bd097c35b0b6fc920fb0722','9778397bd097c36b0b6fc9274c91aa',
              '97b6b7f0e47f531b0723b0b6fb0721','7f0e27f1487f531b0b0bb0b6fb0722','7f0e397bd097c35b0b6fc920fb0722',
              '9778397bd097c36b0b6fc9274c91aa','97b6b7f0e47f531b0723b0b6fb0721','7f0e27f1487f531b0b0bb0b6fb0722',
              '7f0e397bd097c35b0b6fc920fb0722','9778397bd097c36b0b6fc9274c91aa','97b6b7f0e47f531b0723b0b6fb0721',
              '7f0e27f1487f531b0b0bb0b6fb0722','7f0e397bd07f595b0b0bc920fb0722','9778397bd097c36b0b6fc9274c91aa',
              '97b6b7f0e47f531b0723b0787b0721','7f0e27f0e47f531b0b0bb0b6fb0722','7f0e397bd07f595b0b0bc920fb0722',
              '9778397bd097c36b0b6fc9210c91aa','97b6b7f0e47f149b0723b0787b0721','7f0e27f0e47f531b0723b0b6fb0722',
              '7f0e397bd07f595b0b0bc920fb0722','9778397bd097c36b0b6fc9210c8dc2','977837f0e37f149b0723b0787b0721',
              '7f07e7f0e47f531b0723b0b6fb0722','7f0e37f5307f595b0b0bc920fb0722','7f0e397bd097c35b0b6fc9210c8dc2',
              '977837f0e37f14998082b0787b0721','7f07e7f0e47f531b0723b0b6fb0721','7f0e37f1487f595b0b0bb0b6fb0722',
              '7f0e397bd097c35b0b6fc9210c8dc2','977837f0e37f14998082b0787b06bd','7f07e7f0e47f531b0723b0b6fb0721',
              '7f0e27f1487f531b0b0bb0b6fb0722','7f0e397bd097c35b0b6fc920fb0722','977837f0e37f14998082b0787b06bd',
              '7f07e7f0e47f531b0723b0b6fb0721','7f0e27f1487f531b0b0bb0b6fb0722','7f0e397bd097c35b0b6fc920fb0722',
              '977837f0e37f14998082b0787b06bd','7f07e7f0e47f531b0723b0b6fb0721','7f0e27f1487f531b0b0bb0b6fb0722',
              '7f0e397bd07f595b0b0bc920fb0722','977837f0e37f14998082b0787b06bd','7f07e7f0e47f531b0723b0b6fb0721',
              '7f0e27f1487f531b0b0bb0b6fb0722','7f0e397bd07f595b0b0bc920fb0722','977837f0e37f14998082b0787b06bd',
              '7f07e7f0e47f149b0723b0787b0721','7f0e27f0e47f531b0b0bb0b6fb0722','7f0e397bd07f595b0b0bc920fb0722',
              '977837f0e37f14998082b0723b06bd','7f07e7f0e37f149b0723b0787b0721','7f0e27f0e47f531b0723b0b6fb0722',
              '7f0e397bd07f595b0b0bc920fb0722','977837f0e37f14898082b0723b02d5','7ec967f0e37f14998082b0787b0721',
              '7f07e7f0e47f531b0723b0b6fb0722','7f0e37f1487f595b0b0bb0b6fb0722','7f0e37f0e37f14898082b0723b02d5',
              '7ec967f0e37f14998082b0787b0721','7f07e7f0e47f531b0723b0b6fb0722','7f0e37f1487f531b0b0bb0b6fb0722',
              '7f0e37f0e37f14898082b0723b02d5','7ec967f0e37f14998082b0787b06bd','7f07e7f0e47f531b0723b0b6fb0721',
              '7f0e37f1487f531b0b0bb0b6fb0722','7f0e37f0e37f14898082b072297c35','7ec967f0e37f14998082b0787b06bd',
              '7f07e7f0e47f531b0723b0b6fb0721','7f0e27f1487f531b0b0bb0b6fb0722','7f0e37f0e37f14898082b072297c35',
              '7ec967f0e37f14998082b0787b06bd','7f07e7f0e47f531b0723b0b6fb0721','7f0e27f1487f531b0b0bb0b6fb0722',
              '7f0e37f0e366aa89801eb072297c35','7ec967f0e37f14998082b0787b06bd','7f07e7f0e47f149b0723b0787b0721',
              '7f0e27f1487f531b0b0bb0b6fb0722','7f0e37f0e366aa89801eb072297c35','7ec967f0e37f14998082b0723b06bd',
              '7f07e7f0e47f149b0723b0787b0721','7f0e27f0e47f531b0723b0b6fb0722','7f0e37f0e366aa89801eb072297c35',
              '7ec967f0e37f14998082b0723b06bd','7f07e7f0e37f14998083b0787b0721','7f0e27f0e47f531b0723b0b6fb0722',
              '7f0e37f0e366aa89801eb072297c35','7ec967f0e37f14898082b0723b02d5','7f07e7f0e37f14998082b0787b0721',
              '7f07e7f0e47f531b0723b0b6fb0722','7f0e36665b66aa89801e9808297c35','665f67f0e37f14898082b0723b02d5',
              '7ec967f0e37f14998082b0787b0721','7f07e7f0e47f531b0723b0b6fb0722','7f0e36665b66a449801e9808297c35',
              '665f67f0e37f14898082b0723b02d5','7ec967f0e37f14998082b0787b06bd','7f07e7f0e47f531b0723b0b6fb0721',
              '7f0e36665b66a449801e9808297c35','665f67f0e37f14898082b072297c35','7ec967f0e37f14998082b0787b06bd',
              '7f07e7f0e47f531b0723b0b6fb0721','7f0e26665b66a449801e9808297c35','665f67f0e37f1489801eb072297c35',
              '7ec967f0e37f14998082b0787b06bd','7f07e7f0e47f531b0723b0b6fb0721','7f0e27f1487f531b0b0bb0b6fb0722'],

    /**
      * 数字转中文速查表
      * @Array Of Property 
      * @trans ['日','一','二','三','四','五','六','七','八','九','十']
      * @return Cn string 
      */
    nStr1:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d","\u5341"],

    /**
      * 日期转农历称呼速查表
      * @Array Of Property 
      * @trans ['初','十','廿','卅']
      * @return Cn string 
      */
    nStr2:["\u521d","\u5341","\u5eff","\u5345"],

    /**
      * 月份转农历称呼速查表
      * @Array Of Property 
      * @trans ['正','一','二','三','四','五','六','七','八','九','十','冬','腊']
      * @return Cn string 
      */
    nStr3:["\u6b63","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d","\u5341","\u51ac","\u814a"],

    /**
      * 返回农历y年一整年的总天数
      * @param lunar Year
      * @return Number
      * @eg:var count = calendar.lYearDays(1987) ;//count=387
      */
    lYearDays:function(y) {
        var i, sum = 348;
        for(i=0x8000; i>0x8; i>>=1) { sum += (calendar.lunarInfo[y-1900] & i)? 1: 0; }
        return(sum+calendar.leapDays(y));
    },

    /**
      * 返回农历y年闰月是哪个月；若y年没有闰月 则返回0
      * @param lunar Year
      * @return Number (0-12)
      * @eg:var leapMonth = calendar.leapMonth(1987) ;//leapMonth=6
      */
    leapMonth:function(y) { //闰字编码 \u95f0
        return(calendar.lunarInfo[y-1900] & 0xf);
    },

    /**
      * 返回农历y年闰月的天数 若该年没有闰月则返回0
      * @param lunar Year
      * @return Number (0、29、30)
      * @eg:var leapMonthDay = calendar.leapDays(1987) ;//leapMonthDay=29
      */
    leapDays:function(y) {
        if(calendar.leapMonth(y))  { 
            return((calendar.lunarInfo[y-1900] & 0x10000)? 30: 29); 
        }
        return(0);
    },

    /**
      * 返回农历y年m月（非闰月）的总天数，计算m为闰月时的天数请使用leapDays方法
      * @param lunar Year
      * @return Number (-1、29、30)
      * @eg:var MonthDay = calendar.monthDays(1987,9) ;//MonthDay=29
      */
    monthDays:function(y,m) {
        if(m>12 || m<1) {return -1}//月份参数从1至12，参数错误返回-1
        return( (calendar.lunarInfo[y-1900] & (0x10000>>m))? 30: 29 );
    },

    /**
      * 返回公历(!)y年m月的天数
      * @param solar Year
      * @return Number (-1、28、29、30、31)
      * @eg:var solarMonthDay = calendar.leapDays(1987) ;//solarMonthDay=30
      */
    solarDays:function(y,m) {
        if(m>12 || m<1) {return -1} //若参数错误 返回-1
        var ms = m-1;
        if(ms==1) { //2月份的闰平规律测算后确认返回28或29
            return(((y%4 == 0) && (y%100 != 0) || (y%400 == 0))? 29: 28);
        }else {
            return(calendar.solarMonth[ms]);
        }
    },

    /**
     * 农历年份转换为干支纪年
     * @param  lYear 农历年的年份数
     * @return Cn string
     */
    toGanZhiYear:function(lYear) {
        var ganKey = (lYear - 3) % 10;
        var zhiKey = (lYear - 3) % 12;
        if(ganKey == 0) ganKey = 10;//如果余数为0则为最后一个天干
        if(zhiKey == 0) zhiKey = 12;//如果余数为0则为最后一个地支
        return calendar.Gan[ganKey-1] + calendar.Zhi[zhiKey-1];
        
    },

    /**
     * 公历月、日判断所属星座
     * @param  cMonth [description]
     * @param  cDay [description]
     * @return Cn string
     */
    toAstro:function(cMonth,cDay) {
        var s   = "\u9b54\u7faf\u6c34\u74f6\u53cc\u9c7c\u767d\u7f8a\u91d1\u725b\u53cc\u5b50\u5de8\u87f9\u72ee\u5b50\u5904\u5973\u5929\u79e4\u5929\u874e\u5c04\u624b\u9b54\u7faf";
        var arr = [20,19,21,21,21,22,23,23,23,23,22,22];
        return s.substr(cMonth*2 - (cDay < arr[cMonth-1] ? 2 : 0),2) + "\u5ea7";//座
    },

    /**
      * 传入offset偏移量返回干支
      * @param offset 相对甲子的偏移量
      * @return Cn string
      */
    toGanZhi:function(offset) {
        return calendar.Gan[offset%10] + calendar.Zhi[offset%12];
    },

    /**
      * 传入公历(!)y年获得该年第n个节气的公历日期
      * @param y公历年(1900-2100)；n二十四节气中的第几个节气(1~24)；从n=1(小寒)算起 
      * @return day Number
      * @eg:var _24 = calendar.getTerm(1987,3) ;//_24=4;意即1987年2月4日立春
      */
    getTerm:function(y,n) {
        if(y<1900 || y>2100) {return -1;}
        if(n<1 || n>24) {return -1;}
        var _table = calendar.sTermInfo[y-1900];
        var _info = [
            parseInt('0x'+_table.substr(0,5)).toString() ,
            parseInt('0x'+_table.substr(5,5)).toString(),
            parseInt('0x'+_table.substr(10,5)).toString(),
            parseInt('0x'+_table.substr(15,5)).toString(),
            parseInt('0x'+_table.substr(20,5)).toString(),
            parseInt('0x'+_table.substr(25,5)).toString()
        ];
        var _calday = [
            _info[0].substr(0,1),
            _info[0].substr(1,2),
            _info[0].substr(3,1),
            _info[0].substr(4,2),
            
            _info[1].substr(0,1),
            _info[1].substr(1,2),
            _info[1].substr(3,1),
            _info[1].substr(4,2),
            
            _info[2].substr(0,1),
            _info[2].substr(1,2),
            _info[2].substr(3,1),
            _info[2].substr(4,2),
            
            _info[3].substr(0,1),
            _info[3].substr(1,2),
            _info[3].substr(3,1),
            _info[3].substr(4,2),
            
            _info[4].substr(0,1),
            _info[4].substr(1,2),
            _info[4].substr(3,1),
            _info[4].substr(4,2),
            
            _info[5].substr(0,1),
            _info[5].substr(1,2),
            _info[5].substr(3,1),
            _info[5].substr(4,2),
        ];
        return parseInt(_calday[n-1]);
    },

    /**
      * 传入农历数字月份返回汉语通俗表示法
      * @param lunar month
      * @return Cn string
      * @eg:var cnMonth = calendar.toChinaMonth(12) ;//cnMonth='腊月'
      */
    toChinaMonth:function(m) { // 月 => \u6708
        if(m>12 || m<1) {return -1} //若参数错误 返回-1
        var s = calendar.nStr3[m-1];
        s+= "\u6708";//加上月字
        return s;
    },

    /**
      * 传入农历日期数字返回汉字表示法
      * @param lunar day
      * @return Cn string
      * @eg:var cnDay = calendar.toChinaDay(21) ;//cnMonth='廿一'
      */
    toChinaDay:function(d){ //日 => \u65e5
        var s;
        switch (d) {
            case 10:
            s = '\u521d\u5341'; break;
        case 20:
            s = '\u4e8c\u5341'; break;
            break;
        case 30:
            s = '\u4e09\u5341'; break;
            break;
        default :
            s = calendar.nStr2[Math.floor(d/10)];
            s += calendar.nStr1[d%10];
        }
        return(s);
    },

    /**
      * 年份转生肖[!仅能大致转换] => 精确划分生肖分界线是“立春”
      * @param y year
      * @return Cn string
      * @eg:var animal = calendar.getAnimal(1987) ;//animal='兔'
      */
    getAnimal: function(y) {
        return calendar.Animals[(y - 4) % 12]
    },

    /**
      * 传入阳历年月日获得详细的公历、农历object信息 <=>JSON
      * @param y  solar year
      * @param m  solar month
      * @param d  solar day
      * @return JSON object
      * @eg:console.log(calendar.solar2lunar(1987,11,01));
      */
    solar2lunar:function (y,m,d) { //参数区间1900.1.31~2100.12.31
        //年份限定、上限
        if(y<1900 || y>2100) {
            return -1;// undefined转换为数字变为NaN
        }
        //公历传参最下限
        if(y==1900&&m==1&&d<31) {
            return -1;
        }
        //未传参  获得当天
        if(!y) {
            var objDate = new Date();
        }else {
            var objDate = new Date(y,parseInt(m)-1,d)
        }
        var i, leap=0, temp=0;
        //修正ymd参数
        var y = objDate.getFullYear(),
            m = objDate.getMonth()+1,
            d = objDate.getDate();
        var offset = (Date.UTC(objDate.getFullYear(),objDate.getMonth(),objDate.getDate()) - Date.UTC(1900,0,31))/86400000;
        for(i=1900; i<2101 && offset>0; i++) {
            temp    = calendar.lYearDays(i);
            offset -= temp;
        }
        if(offset<0) {
            offset+=temp; i--;
        }
        
        //是否今天
        var isTodayObj = new Date(),
            isToday    = false;
        if(isTodayObj.getFullYear()==y && isTodayObj.getMonth()+1==m && isTodayObj.getDate()==d) {
            isToday = true;
        }
        //星期几
        var nWeek = objDate.getDay(),
           cWeek  = calendar.nStr1[nWeek];
        //数字表示周几顺应天朝周一开始的惯例
        if(nWeek==0) {
            nWeek = 7;
        }
        //农历年
        var year   = i;
        var leap   = calendar.leapMonth(i); //闰哪个月
        var isLeap = false;
        
        //效验闰月
        for(i=1; i<13 && offset>0; i++) {
            //闰月
            if(leap>0 && i==(leap+1) && isLeap==false){ 
                --i;
                isLeap = true; temp = calendar.leapDays(year); //计算农历闰月天数
            }
            else{
                temp = calendar.monthDays(year, i);//计算农历普通月天数
            }
            //解除闰月
            if(isLeap==true && i==(leap+1)) { isLeap = false; }
            offset -= temp;
        }
        // 闰月导致数组下标重叠取反
        if(offset==0 && leap>0 && i==leap+1)
        {
            if(isLeap){
                isLeap = false;
            }else{ 
                isLeap = true; --i;
            }
        }
        if(offset<0)
        {
            offset += temp; --i;
        }
        //农历月
        var month      = i;
        //农历日
        var day        = offset + 1;
        //天干地支处理
        var sm         = m-1;
		
		//立春时间为新的一年
		var _tmpdizhi=yearToJieQi(y);
		if((m*1==_tmpdizhi.month)&&(d*1<_tmpdizhi.day)) y=y*1-1;
		else if(m*1<_tmpdizhi.month) y=y*1-1;
		
        var gzY  = calendar.toGanZhiYear(y);
        
        // 当月的两个节气
        // bugfix-2017-7-24 11:03:38 use lunar Year Param `y` Not `year`
        var firstNode  = calendar.getTerm(y,(m*2-1));//返回当月「节」为几日开始
        var secondNode = calendar.getTerm(y,(m*2));//返回当月「节」为几日开始

        // 依据12节气修正干支月
        var gzM        = calendar.toGanZhi((y-1900)*12+m+11);
        if(d>=firstNode) {
            gzM        = calendar.toGanZhi((y-1900)*12+m+12);
        }
        
        //传入的日期的节气与否
        var isTerm = false;
        var Term   = null;
        if(firstNode==d) {
            isTerm  = true;
            Term    = calendar.solarTerm[m*2-2];
        }
        if(secondNode==d) {
            isTerm  = true;
            Term    = calendar.solarTerm[m*2-1];
        }
        //日柱 当月一日与 1900/1/1 相差天数
        var dayCyclical = Date.UTC(y,sm,1,0,0,0,0)/86400000+25567+10;
        var gzD         = calendar.toGanZhi(dayCyclical+d-1);
        //该日期所属的星座
        var astro       = calendar.toAstro(m,d);
        
        return {'lYear':year,'lMonth':month,'lDay':day,'Animal':calendar.getAnimal(year),'IMonthCn':(isLeap?"\u95f0":'')+calendar.toChinaMonth(month),'IDayCn':calendar.toChinaDay(day),'cYear':y,'cMonth':m,'cDay':d,'gzYear':gzY,'gzMonth':gzM,'gzDay':gzD,'isToday':isToday,'isLeap':isLeap,'nWeek':nWeek,'ncWeek':"\u661f\u671f"+cWeek,'isTerm':isTerm,'Term':Term,'astro':astro};
    },

    /**
      * 传入农历年月日以及传入的月份是否闰月获得详细的公历、农历object信息 <=>JSON
      * @param y  lunar year
      * @param m  lunar month
      * @param d  lunar day
      * @param isLeapMonth  lunar month is leap or not.[如果是农历闰月第四个参数赋值true即可]
      * @return JSON object
      * @eg:console.log(calendar.lunar2solar(1987,9,10));
      */
    lunar2solar:function(y,m,d,isLeapMonth) {   //参数区间1900.1.31~2100.12.1
        var isLeapMonth = !!isLeapMonth;
        var leapOffset  = 0;
        var leapMonth   = calendar.leapMonth(y);
        var leapDay     = calendar.leapDays(y);
        if(isLeapMonth&&(leapMonth!=m)) {return -1;}//传参要求计算该闰月公历 但该年得出的闰月与传参的月份并不同
        if(y==2100&&m==12&&d>1 || y==1900&&m==1&&d<31) {return -1;}//超出了最大极限值 
        var day  = calendar.monthDays(y,m); 
        var _day = day;
        //bugFix 2016-9-25 
        //if month is leap, _day use leapDays method 
        if(isLeapMonth) {
            _day = calendar.leapDays(y,m);
        }
        if(y < 1900 || y > 2100 || d > _day) {return -1;}//参数合法性效验
        
        //计算农历的时间差
        var offset = 0;
        for(var i=1900;i<y;i++) {
            offset+=calendar.lYearDays(i);
        }
        var leap = 0,isAdd= false;
        for(var i=1;i<m;i++) {
            leap = calendar.leapMonth(y);
            if(!isAdd) {//处理闰月
                if(leap<=i && leap>0) {
                    offset+=calendar.leapDays(y);isAdd = true;
                }
            }
            offset+=calendar.monthDays(y,i);
        }
        //转换闰月农历 需补充该年闰月的前一个月的时差
        if(isLeapMonth) {offset+=day;}
        //1900年农历正月一日的公历时间为1900年1月30日0时0分0秒(该时间也是本农历的最开始起始点)
        var stmap   =   Date.UTC(1900,1,30,0,0,0);
        var calObj  =   new Date((offset+d-31)*86400000+stmap);
        var cY      =   calObj.getUTCFullYear();
        var cM      =   calObj.getUTCMonth()+1;
        var cD      =   calObj.getUTCDate();

        return calendar.solar2lunar(cY,cM,cD);
    }
};



//根据年返回立春时间
function yearToJieQi(year){
	year=year.toString();
	//计算公式：[Y*D+C]-L
	//年数的后2位乘0.2422加C取整数减闰年数
	//C不同节气不同世纪值不一样。 比如立春。21世纪C值=3.87，22世纪C值=4.15。   21世纪雨水的C值18.73。
	var y=(year.substring(year.length-2))*1;
	var d=0.2422;
	//暂时计算21世纪
	//立春、雨水、惊蛰、春分、清明、谷雨、立夏、小满、芒种、夏至、小暑、大暑，立秋、处暑、白露、秋分、寒露、霜降，立冬、小雪、大雪、冬至、小寒、大寒。
	var jieqi=["立春","雨水","惊蛰","春分","清明","谷雨","立夏","小满","芒种","夏至","小暑","大暑","立秋","处暑","白露","秋分","寒露","霜降","立冬","小雪","大雪","冬至","小寒","大寒"];
	var cArr=[3.87,18.73,5.63,20.646,4.81,20.1,5.52,21.04,5.678,21.37,7.108,22.83,7.5,23.13,7.646,23.042,8.318,23.438,7.438,22.36,7.18,21.94,5.4055,20.12];
	
	
	var jieqi=["立春","惊蛰","清明","立夏","芒种","小暑","立秋","白露","寒露","立冬","大雪","小寒"];
	var monthZhi=["寅","卯","辰","巳","午","未","申","酉","戌","亥","子","丑"];
	var cArr=[3.87,5.63,4.81,5.52,5.678,7.108,7.5,7.646,8.318,7.438,7.18,5.4055];
	//向下取整
	var l=Math.floor((y-1)/4);
	/**
	寅月 立春-惊蛰
	卯月 惊蛰-清明
	辰月 清明-立夏
	巳月 立夏-芒种
	午月 芒种-小暑
	未月 小暑-立秋
	申月 立秋-白露
	酉月 白露-寒露
	戌月 寒露-立冬
	亥月 立冬-大雪
	子月 大雪-小寒
	丑月 小寒-立春
	**/
	var retObj={};
	
	
	var month=1;
	for(var i=0;i<cArr.length;i=i+1){
		//节气对应的日
		var day=Math.floor(y*d+cArr[i])-l;
		//2月份是寅月
		month=month+1;
		//1月份对应丑月
		if(month>12) month=month-12;
		
		var obj={
			dizhi:monthZhi[i],
			month:month,
			day:day,
			jieqi:jieqi[i]
		};
		retObj[month]=obj;
		
	}
	return retObj[2];
}

/**
将时转成干支
**/
function hourToGanZhi(hour,riGan){
	var shiChen={
		23:'子',
		0:'子',
		1:'丑',
		2:'丑',
		3:'寅',
		4:'寅',
		5:'卯',
		6:'卯',
		7:'辰',
		8:'辰',
		9:'巳',
		10:'巳',
		11:'午',
		12:'午',
		13:'未',
		14:'未',
		15:'申',
		16:'申',
		17:'酉',
		18:'酉',
		19:'戌',
		20:'戌',
		21:'亥',
		22:'亥',
	};
	//将时转成支
	hour=hour*1;
	var shizhi=shiChen[hour];
	
		
	//时干根据日干遁出来
	var shiGan1=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"];	
	var shiGan2=["丙","丁","戊","己","庚","辛","壬","癸","甲","乙"];
	var shiGan3=["戊","己","庚","辛","壬","癸","甲","乙","丙","丁"];
	var shiGan4=["庚","辛","壬","癸","甲","乙","丙","丁","戊","己"];
	var shiGan5=["壬","癸","甲","乙","丙","丁","戊","己","庚","辛"];
	
	var shiGanArr=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸","甲","乙","丙","丁","戊","己","庚","辛","壬","癸"];
	var shiZhiObj={
		"子":0,
		"丑":1,
		"寅":2,
		"卯":3,
		"辰":4,
		"巳":5,
		"午":6,
		"未":7,
		"申":8,
		"酉":9,
		"戌":10,
		"亥":11
		};
	
	//从干上的第几个起。
	var flag=0;
	if(riGan=='甲'||riGan=='己'){
		flag=0;//甲子
	}else if(riGan=='乙'||riGan=='庚'){
		flag=2;//丙子
	}else if(riGan=='丙'||riGan=='辛'){
		flag=4;//戊子
	}else if(riGan=='丁'||riGan=='壬'){
		flag=6;//庚子
	}else if(riGan=='戊'||riGan=='癸'){
		flag=8;//壬子
	}
	//获取索引
	var index=shiZhiObj[shizhi];
	flag=index+flag;
	//获取干
	var shiGan=shiGanArr[flag];
	
	return {gzShi:shiGan+""+shizhi};
	
}



/**
将年月日时 转成干支
**/
function getSolarLunar(year,month,day,hour){
	//年月日转成干支
	var lunarObj=calendar.solar2lunar("2018","02","27");
	//时转成干支
	var riGan=lunarObj.gzDay.charAt(0);
	var shiGanZhi=hourToGanZhi(hour,riGan);
	
	return {
		gzYear:lunarObj.gzYear,
		gzMonth:lunarObj.gzMonth,
		gzDay:lunarObj.gzDay,
		gzShi:shiGanZhi.gzShi
	};
}



</script>

</body>
</html>
